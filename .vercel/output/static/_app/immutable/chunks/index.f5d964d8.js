import{D as X,U as se,N as we,P as Ee,a as he,b as oe,i as ae,g as ve,c as Te,s as V,H as Se,p as ie}from"./parse.1d2978b5.js";import{j as C}from"./singletons.79900e43.js";import{p as J}from"./stores.8dce5407.js";import{d as U,w as x}from"./index.3dc40cc0.js";import{a1 as ce,a2 as N,t as le}from"./index.db2b4dea.js";const ke=!0;function ue(t,n){const u=[],i=new Map,c=[];for(const o in n)c.push({key:o,fn:n[o]});const a=[];let r=0;function h(o){if(typeof o=="function")throw new X("Cannot stringify a function",a);if(i.has(o))return i.get(o);if(o===void 0)return se;if(Number.isNaN(o))return we;if(o===1/0)return Ee;if(o===-1/0)return he;if(o===0&&1/o<0)return oe;const M=r++;i.set(o,M);for(const{key:I,fn:O}of c){const E=O(o);if(E)return u[M]=`["${I}",${h(E)}]`,M}let l="";if(ae(o))l=K(o);else switch(ve(o)){case"Number":case"String":case"Boolean":l=`["Object",${K(o)}]`;break;case"BigInt":l=`["BigInt",${o}]`;break;case"Date":l=`["Date","${o.toISOString()}"]`;break;case"RegExp":const{source:O,flags:E}=o;l=E?`["RegExp",${V(O)},"${E}"]`:`["RegExp",${V(O)}]`;break;case"Array":l="[";for(let d=0;d<o.length;d+=1)d>0&&(l+=","),d in o?(a.push(`[${d}]`),l+=h(o[d]),a.pop()):l+=Se;l+="]";break;case"Set":l='["Set"';for(const d of o)l+=`,${h(d)}`;l+="]";break;case"Map":l='["Map"';for(const[d,w]of o)a.push(`.get(${ae(d)?K(d):"..."})`),l+=`,${h(d)},${h(w)}`;l+="]";break;default:if(!Te(o))throw new X("Cannot stringify arbitrary non-POJOs",a);if(Object.getOwnPropertySymbols(o).length>0)throw new X("Cannot stringify POJOs with symbolic keys",a);if(Object.getPrototypeOf(o)===null){l='["null"';for(const d in o)a.push(`.${d}`),l+=`,${V(d)},${h(o[d])}`,a.pop();l+="]"}else{l="{";let d=!1;for(const w in o)d&&(l+=","),d=!0,a.push(`.${w}`),l+=`${V(w)}:${h(o[w])}`,a.pop();l+="}"}}return u[M]=l,M}const $=h(t);return $<0?`${$}`:`[${u.join(",")}]`}function K(t){const n=typeof t;return n==="string"?V(t):t instanceof String?V(t.toString()):t===void 0?se.toString():t===0&&1/t<0?oe.toString():n==="bigint"?`["BigInt","${t}"]`:String(t)}const fe=ke;C.disable_scroll_handling;const Ce=C.goto;C.invalidate;const de=C.invalidateAll;C.preload_data;C.preload_code;const Fe=C.before_navigate;C.after_navigate;const Z=C.apply_action;function Me(t){const n=JSON.parse(t);return n.data&&(n.data=ie(n.data)),n}function _e(t,n=()=>{}){const u=async({action:c,result:a,reset:r})=>{a.type==="success"&&(r!==!1&&HTMLFormElement.prototype.reset.call(t),await de()),(location.origin+location.pathname===c.origin+c.pathname||a.type==="redirect"||a.type==="error")&&Z(a)};async function i(c){var O,E,d;c.preventDefault();const a=new URL((O=c.submitter)!=null&&O.hasAttribute("formaction")?c.submitter.formAction:HTMLFormElement.prototype.cloneNode.call(t).action),r=new FormData(t),h=(E=c.submitter)==null?void 0:E.getAttribute("name");h&&r.append(h,((d=c.submitter)==null?void 0:d.getAttribute("value"))??"");const $=new AbortController;let o=!1;const l=await n({action:a,cancel:()=>o=!0,controller:$,data:r,form:t,submitter:c.submitter})??u;if(o)return;let I;try{const w=await fetch(a,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:r,signal:$.signal});I=Me(await w.text()),I.type==="error"&&(I.status=w.status)}catch(w){if((w==null?void 0:w.name)==="AbortError")return;I={type:"error",error:w}}l({action:a,data:r,form:t,update:w=>u({action:a,result:I,reset:w==null?void 0:w.reset}),result:I})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",i),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",i)}}}const Ae=(t,n=0)=>{const u=t.getBoundingClientRect();return u.top>=n&&u.left>=0&&u.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&u.right<=(window.innerWidth||document.documentElement.clientWidth)},Oe=(t,n=1.125,u="smooth")=>{const a=t.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*n);window.scrollTo({left:0,top:a,behavior:u})};class P extends Error{constructor(n){super(n),Object.setPrototypeOf(this,P.prototype)}}function ye(t,n=!0){const u={},i=Object.entries(t);if(i.length===1&&i[0][0]==="_errors"&&t._errors.length)return n?t:t._errors;t._errors.length&&(u._errors=t._errors);for(const[c,a]of i.filter(([r])=>r!=="_errors"))u[c]=ye(a,!1);return u}function me(t,n=[]){return Object.entries(t).flatMap(([i,c])=>{if(Array.isArray(c)&&c.length>0){const a=n.concat([i]);return c.map(r=>({path:a,message:r}))}else return me(t[i],n.concat([i]))})}async function Ne(t,n,u){if(!n.length)return;n=[...n];let i=t;for(;n.length>1;){const a=n[0],r=u?await u({parent:i,key:String(a),value:i[a]}):i[a];if(r===void 0)return;i=r,n.shift()}const c=n[0];return{parent:i,key:String(c),value:i[c]}}function Y(t,n,u){if(!n.length)return;n=[...n];let i=t;for(;n.length>1;){const a=n[0],r=u?u({parent:i,key:String(a),value:i[a]}):i[a];if(r===void 0)return;i=r,n.shift()}const c=n[0];return{parent:i,key:String(c),value:i[c]}}async function pe(t,n,u=[]){for(const i in t){const c=t[i],a={parent:t,key:i,value:c,path:u.map(String).concat([i])},r=await n(a);if(r==="abort")return r;if(r==="skip")continue;if(typeof c=="object"){const h=await pe(c,n,a.path);if(h==="abort")return h}}}function De(t){return Array.isArray(t)?t:[t]}function Q(t,n){const u=De(n),i=U(t,c=>{const a=Y(c,u);return a==null?void 0:a.value});return{subscribe(...c){const a=i.subscribe(...c);return()=>{a()}},update(c){t.update(a=>{const r=Y(a,u);return r&&(r.parent[r.key]=c(r.value)),a})},set(c){t.update(a=>{const r=Y(a,u);return r&&(r.parent[r.key]=c),a})}}}function W(t){return"structuredClone"in globalThis?structuredClone(t):ie(ue(t))}var D;(function(t){t[t.Idle=0]="Idle",t[t.Submitting=1]="Submitting",t[t.Delayed=2]="Delayed",t[t.Timeout=3]="Timeout"})(D||(D={}));const Ie={applyAction:!0,invalidateAll:!0,resetForm:!1,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:"[data-invalid]",selectErrorText:!1,stickyNavbar:void 0,taintedMessage:"Do you want to leave this page? Changes you made may not be saved.",onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:void 0,dataType:"form",validators:void 0,defaultValidator:"keep",clearOnSubmit:"errors-and-message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",validation:void 0};function Le(t,n={}){n={...Ie,...n};function u(){return{valid:!1,errors:{},data:{},empty:!0,constraints:{}}}function i(e){return Object.values(e).filter(s=>c(s)!==!1)}function c(e){return!e||typeof e!="object"||!("valid"in e&&"empty"in e&&typeof e.valid=="boolean")?!1:"id"in e&&typeof e.id=="string"?e.id:void 0}if(typeof t=="string"&&typeof n.id=="string")throw new P("You cannot specify an id both in the first superForm argument and in the options.");const a=[];ce(()=>{a.forEach(e=>e());for(const e of Object.values(k))e.length=0});let r=typeof t=="string"?t:n.id??(t==null?void 0:t.id);const h=x(r);a.push(h.subscribe(e=>r=e));{const e=N(J).form;if(e&&typeof e=="object"){for(const s of i(e).reverse())if(s.id===r){t=s;break}}}function $(e,s){if(!(!s||typeof s!="object")){if(Array.isArray(s))s.length>0&&$(e,s[0]);else if(!(s instanceof Date))throw new P(`Object found in form field "${e}". Set options.dataType = 'json' and use:enhance to use nested data structures.`)}}if(!t||typeof t=="string")t=u();else if(n.dataType!=="json")for(const[e,s]of Object.entries(t.data))$(e,s);const o=W(t),M=W(t),l=x(M.valid),I=x(M.empty),O=x(M.message),E=x(M.errors),d=x(M.data),w=x(M.constraints),q=x(M.meta),L=x(),R=x(!1),H=x(!1),p=x(!1),S=U(E,e=>e?me(e):[]),A=U(S,e=>e[0]??null);if(typeof o.valid!="boolean")throw new P("A non-validation object was passed to superForm. Check what's passed to its first parameter (null/undefined is allowed).");const y=n.taintedMessage;n.taintedMessage=void 0;function g(){n.taintedMessage=y}function m(e,s,T){if(s&&(L.set(typeof s=="boolean"?void 0:s),j=W(e.data)),T=T??e.message,d.set(e.data),O.set(T),I.set(e.empty),l.set(e.valid),E.set(e.errors),q.set(e.meta),h.set(e.id),n.flashMessage&&te(n)){const b=n.flashMessage.module.getFlash(J);T&&N(b)===void 0&&b.set(T)}}async function f(e,s){let T=!1;const b={form:e,cancel:()=>T=!0};for(const F of k.onUpdate)await F(b);if(T){n.flashMessage&&ee(n);return}e.valid&&n.resetForm?v(e.message):m(e,s),k.onUpdated.length&&await le();for(const F of k.onUpdated)F({form:e})}function v(e){m(W(o),!0,e)}const _=async(e,s)=>{if(e.type=="error")throw new P(`ActionResult of type "${e.type}" cannot be passed to update function.`);if(e.type=="redirect"){n.resetForm&&v();return}if(typeof e.data!="object")throw new P("Non-object validation data returned from ActionResult.");const T=i(e.data);if(!T.length)throw new P("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const b of T)b.id===r&&await f(b,s??(e.status>=200&&e.status<300))},k={onSubmit:n.onSubmit?[n.onSubmit]:[],onResult:n.onResult?[n.onResult]:[],onUpdate:n.onUpdate?[n.onUpdate]:[],onUpdated:n.onUpdated?[n.onUpdated]:[],onError:n.onError?[n.onError]:[]};async function B(e,s,T=[]){if(e!==null&&s!==null&&typeof e=="object"&&typeof s=="object")if(e instanceof Date){if(s instanceof Date&&e.getTime()==s.getTime())return}else{for(const b in e)await B(e[b],s[b],T.concat([b]));return}else if(e===s)return;L.update(b=>{b||(b={});const F=Y(b,T,({parent:z,key:G,value:ne})=>(ne===void 0?z[G]={}:ne===!0&&(z[G]={}),z[G]));return F&&(F.parent[F.key]=!0),b}),n.defaultValidator=="clear"&&E.update(b=>{const F=Y(b,T);return F&&delete F.parent[F.key],b})}let j;function re(e){if(e===null)throw new P("$tainted store contained null");if(typeof e=="object"){for(const s of Object.values(e))if(re(s))return!0}return e===!0}Fe(e=>{if(n.taintedMessage&&!N(R)){const s=N(L);s&&re(s)&&!window.confirm(n.taintedMessage)&&e.cancel()}}),a.push(d.subscribe(async e=>{if(!j){j=o.data;return}N(R)||(await B(e,j),j=W(e))})),n.applyAction&&a.push(J.subscribe(async e=>{function s(b){throw new P(`No form data found in ${b}. Make sure you return { form } in form actions and load functions.`)}const T=e.status>=200&&e.status<300;if(e.form&&typeof e.form=="object"){const b=i(e.form);b.length||s("$page.form (ActionData)");for(const F of b)F===t||F.id!==r||(j=void 0,await f(F,T))}else if(e.data&&typeof e.data=="object"){const b=i(e.data);for(const F of b)F===t||F.id!==r||(j=void 0,m(F,T))}}));const be=Object.fromEntries(Object.keys(o.data).map(e=>[e,ge(e,o)]));function ge(e,s){var T;return{name:e,value:Q(d,e),errors:Q(E,e),constraints:Q(w,e),type:(T=s.meta)==null?void 0:T.types[e]}}return{form:d,formId:h,errors:E,message:O,constraints:w,meta:U(q,e=>e),fields:be,tainted:L,valid:U(l,e=>e),empty:U(I,e=>e),submitting:U(R,e=>e),delayed:U(H,e=>e),timeout:U(p,e=>e),options:n,capture:()=>({valid:N(l),errors:N(E),data:N(d),empty:N(I),constraints:N(w),message:N(O),id:r,meta:N(q),tainted:N(L)}),restore:e=>{m(e,e.tainted??!0)},enhance:(e,s)=>{if(s){if(s.onError){if(n.onError==="apply")throw new P('options.onError is set to "apply", cannot add any onError events.');if(s.onError==="apply")throw new P('Cannot add "apply" as onError event in use:enhance.');k.onError.push(s.onError)}s.onResult&&k.onResult.push(s.onResult),s.onSubmit&&k.onSubmit.push(s.onSubmit),s.onUpdate&&k.onUpdate.push(s.onUpdate),s.onUpdated&&k.onUpdated.push(s.onUpdated)}return $e(e,R,H,p,E,_,n,d,O,g,k)},firstError:A,allErrors:S,update:_,reset:e=>v(e!=null&&e.keepMessage?N(O):void 0)}}function ee(t){!t.flashMessage||!fe||te(t)&&(document.cookie=`flash=; Max-Age=0; Path=${t.flashMessage.cookiePath??"/"};`)}function te(t){return!t.flashMessage||!fe?!1:t.syncFlashMessage}function $e(t,n,u,i,c,a,r,h,$,o,M){o();const l=c;function I(p,S){l.update(A=>{const y=Y(A,p,({parent:g,key:m,value:f})=>(f===void 0&&(g[m]={}),g[m]));if(y){const{parent:g,key:m}=y;S===null?delete g[m]:g[m]=S}return A})}async function O(p,S,A){const y=await p(S);return I(A,typeof y=="string"?[y]:y??null),!y}const E=new Set;function d(p){const S=p.target;r.selectErrorText&&S.select()}function w(p){p.querySelectorAll("input").forEach(S=>{S.addEventListener("invalid",d)})}function q(p){p.querySelectorAll("input").forEach(S=>S.removeEventListener("invalid",d))}ce(()=>{E.forEach(p=>q(p)),E.clear()});function L(p){function S(){r.selectErrorText&&(A&&p!==A&&(q(A),E.delete(A)),E.has(p)||(w(p),E.add(p))),A=p}let A;function y(m){return typeof r.autoFocusOnError=="boolean"?r.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(m)}const g=async()=>{if(r.scrollToError=="off")return;const m=r.errorSelector;if(!m)return;await le();let f;if(f=A.querySelector(m),!f)return;f=f.querySelector(m)??f;const v=r.stickyNavbar?document.querySelector(r.stickyNavbar):null;if(Ae(f,(v==null?void 0:v.offsetHeight)??0)||Oe(f,void 0,r.scrollToError),!y(navigator.userAgent))return;let _;if(_=f,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(_.tagName)||(_=_.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),_)try{_.focus({preventScroll:!0}),r.selectErrorText&&_.tagName=="INPUT"&&_.select()}catch{}};S();{let m=D.Idle,f,v;const _=k=>{m=k,n.set(m>=D.Submitting),u.set(m>=D.Delayed),i.set(m>=D.Timeout)};return{submitting:()=>{S(),_(m!=D.Delayed?D.Submitting:D.Delayed),f&&clearTimeout(f),v&&clearTimeout(v),f=window.setTimeout(()=>{m==D.Submitting&&_(D.Delayed)},r.delayMs),v=window.setTimeout(()=>{m==D.Delayed&&_(D.Timeout)},r.timeoutMs)},completed:k=>{f&&clearTimeout(f),v&&clearTimeout(v),f=v=0,_(D.Idle),k||setTimeout(g)},scrollToFirstError:()=>setTimeout(g),isSubmitting:()=>m===D.Submitting||m===D.Delayed}}}const R=L(t);let H;return _e(t,async p=>{let S=!1;function A(){return S=!0,p.cancel()}if(R.isSubmitting()&&r.multipleSubmits=="prevent")A();else{R.isSubmitting()&&r.multipleSubmits=="abort"&&H&&H.abort(),H=p.controller;const y={...p,cancel:A};for(const g of M.onSubmit)await g(y)}if(S)r.flashMessage&&ee(r);else{if(r.validators){const y=N(h);let g;if(r.validators.constructor.name=="ZodObject"||r.validators.constructor.name=="ZodEffects"){const f=await r.validators.safeParseAsync(y);g=f.success,f.success||l.set(ye(f.error.format()))}else{const m=r.validators;g=!0,await pe(y,async({value:f,path:v})=>{const _=v.filter(B=>isNaN(parseInt(B))),k=await Ne(m,_);if(typeof(k==null?void 0:k.value)=="function"){const B=k.value;if(Array.isArray(f)){for(const j in f)await O(B,f[j],v.concat([j]))||(g=!1);return}else await O(B,f,v)||(g=!1)}})}g||(A(),R.scrollToFirstError())}if(!S){switch(r.clearOnSubmit){case"errors-and-message":l.set({}),$.set(void 0);break;case"errors":l.set({});break;case"message":$.set(void 0);break}if(r.flashMessage&&(r.clearOnSubmit=="errors-and-message"||r.clearOnSubmit=="message")&&te(r)&&r.flashMessage.module.getFlash(J).set(void 0),R.submitting(),r.dataType==="json"){const y=N(h);p.data.set("__superform_json",ue(y)),Object.keys(y).forEach(g=>{typeof p.data.get(g)=="string"&&p.data.delete(g)})}}}return async({result:y})=>{H=null;let g=!1;const m={result:y,formEl:t,cancel:()=>g=!0};for(const f of M.onResult)await f(m);if(g)r.flashMessage&&ee(r);else{if(y.type!=="error")y.type==="success"&&r.invalidateAll&&await de(),r.applyAction?await Z(y):await a(y);else if(r.applyAction&&(r.onError=="apply"?await Z(y):await Z({type:"failure",status:Math.floor(y.status||500)})),r.onError!=="apply"){const f={result:y,message:$};for(const v of M.onError)v!=="apply"&&await v(f)}r.flashMessage&&(y.type=="error"&&r.flashMessage.onError?await r.flashMessage.onError({result:y,message:r.flashMessage.module.getFlash(J)}):y.type!="error"&&await r.flashMessage.module.updateFlash(J))}R.completed(g)}})}export{Ce as g,Le as s};
